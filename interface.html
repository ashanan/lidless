<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Lidless Web</title>
</head>
<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="/flot/excanvas.min.js"></script><![endif]-->
<script language="javascript" type="text/javascript" src="/flot/jquery.js"></script>
<script language="javascript" type="text/javascript" src="/flot/jquery.flot.js"></script>
</script>
<script type="text/javascript">

// ratio callback cycle; 1000ms live refresh
function start_ratio() {
	$.ajax({
		url: '/api/camera1/ratio',
		dataType: 'json',
		success: function(data) {
			var mytext;
			if (data.data == null) {
				var mytext = "Unk%";
			} else {
				mytext = Math.round(data.data * 100) + '%';

			}
			$('div.ratio').html(mytext);
			setTimeout(start_ratio, 1000);
		},
		failure: function(data) {
			alert("Call failed for some reason. Reload the page.");
		}
	});
}

var camera1_timeout;
var camera1_period = 3600*1000;

function start_history() {
	$.ajax({
		url: '/api/camera1/history/' + camera1_period,
		dataType: 'json',
		success : function(data) {
			$.plot($("#camera1trace"), [data.data], {
				color: 'green',
				xaxis: { mode: "time" },
				yaxis: { min: 0 }
			});
			// FIXME no hardcode for 120
			camera1_timeout = setTimeout(start_history, camera1_period / 120);
		},
		failure: function(data) {
			alert("Call failed for some reason. Reload the page.");
		}
	});
}

function set_history(per) {
	camera1_period = per;
	clearTimeout(camera1_timeout);
	start_history();
}

$(function () {
	start_ratio();
	start_history();

	$("#quarter").click(function () {
		set_history(60*15*1000);
	});

	$("#hour").click(function () {
		set_history(3600*1000);
	});

	$("#four").click(function () {
		set_history(4*3600*1000);
	});

	$("#day").click(function () {
		set_history(24*3600*1000);
	});

	$("#week").click(function () {
		set_history(7*24*3600*1000);
	});

});     
    
</script>
<body style="height: 100%;">

<h3>camera1</h3>
<div style="text-align: center; width: 100%;">
	<div style="float: left; text-align: center; font-size: 63pt; vertical-align: middle; width: 20%; height: 120px;" id="ratio" class="ratio">Unk%</div>

	<div>
	<div id="camera1trace" style="float: right; width:76%;height:120px;margin: auto;">
	</div>
	</div>
</div>

<div style="float: right; width:76%;height:120px;margin: auto; text-align: center;">
	<tt>Note: times are UTC.</tt>
	<button id="quarter">15 minutes</button>
	<button id="hour">hour</button>
	<button id="four">four hours</button>
	<button id="day">1 day</button>
	<button id="week">1 week</button>
</div>

</body>
</html>

