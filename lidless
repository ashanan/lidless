#!/usr/bin/env python

import sys
import percept
import irclib

class Lidless(irclib.SimpleIRCClient) :
	def __init__(self, server, nick, chan, zm_url) :
		self.percept = percept.Percept(zm_url)
		self.percept.start()
		
		irclib.SimpleIRCClient.__init__(self)
		self.connect(server, 6667, nick)
		self.connection.join(chan)
	
	def on_join(self, c, e) :
		pass

	def on_pubmsg(self, c, e) :
		chan = e.target()
		txt = e.arguments()[0]

		if txt == '!space' :
			self.connection.privmsg(chan, 'the space is %d%% busy right now.' % int(self.percept.ratio_busy * 100))

if __name__ == '__main__' :
	l = Lidless(sys.argv[1], sys.argv[2], sys.argv[3], sys.argv[4])
	try :
		l.start()
	except KeyboardInterrupt :
		print 'exiting'
	finally :
		l.percept.stop()
